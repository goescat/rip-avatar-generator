<!DOCTYPE html>
<head>
  <title>RIP avatar Beta!!</title>
  <style>
    #canvas {
      border: 1px solid #ccc;
      max-width: 100%;
    }
  </style>
</head>
<body>
  <h1>上傳照片</h1>
  <input type="file" id="upload" accept="image/*">
  <br><br>
  <canvas id="canvas" width="500" height="500"></canvas>
  <br>
  <button id="downloadBtn">下載圖片</button>

  <script>
    const upload = document.getElementById('upload');
    const canvas = document.getElementById('canvas');
    const ctx = canvas.getContext('2d');
    const downloadBtn = document.getElementById('downloadBtn');

    const frameImage = new Image();
    frameImage.src = 'frame.png';

    upload.addEventListener('change', (e) => {
      const file = e.target.files[0];
      if (!file) return;

      const reader = new FileReader();
      reader.onload = function (event) {
        const userImage = new Image();
        userImage.onload = function () {
          ctx.clearRect(0, 0, canvas.width, canvas.height);

          const scale = Math.min(canvas.width / userImage.width, canvas.height / userImage.height);
          const x = (canvas.width - userImage.width * scale) / 2;
          const y = (canvas.height - userImage.height * scale) / 2;
          ctx.drawImage(userImage, x, y, userImage.width * scale, userImage.height * scale);

          frameImage.onload = () => {
            ctx.drawImage(frameImage, 0, 0, canvas.width, canvas.height);
          };
          if (frameImage.complete) {
            ctx.drawImage(frameImage, 0, 0, canvas.width, canvas.height);
          }
        };
        userImage.src = event.target.result;
      };
      reader.readAsDataURL(file);
    });

    downloadBtn.addEventListener('click', () => {
      const link = document.createElement('a');
      link.download = 'framed-image.png';
      link.href = canvas.toDataURL('image/png');
      link.click();
    });
  </script>
</body>
</html>
